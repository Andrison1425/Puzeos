
<div class="fondo"></div>

<ion-header>
  <ion-toolbar style=" padding:0;" color="primary">
    <ion-back-button
      slot="start"
      defaultHref="/chat"
      text=""
      mode="md"
    ></ion-back-button>

    <span class="loc_contac-info">
      <img
        src="assets/person.jpg"
        class="chat__img "
      >
      <h6>{{this.contactName}}</h6>
    </span>

    <ion-button slot="end" mode="ios" (click)="presentPopover($event)">
      <ion-icon name="ellipsis-vertical-sharp"></ion-icon>
    </ion-button>
  </ion-toolbar>

</ion-header>
<div class="loc__espacio"></div>

<div class="loc__content" #content>

  <!-- <ion-infinite-scroll threshold="100px" position="top" (ionInfinite)="loadData($event)">
    <ion-infinite-scroll-content loadingSpinner="crescent" loadingText="Loading more data...">
    </ion-infinite-scroll-content>
  </ion-infinite-scroll> -->

  <span *ngFor="let mensaje of mensajes; trackBy: trackByFn; last as isLast">
    <app-item-message
      *ngIf="mensaje.type==='voice'"
      [message]="mensaje"
      [userName]="userName"
      [last]="isLast"
      [dbMessage]="dbMessages"
      [content]="content"
    ></app-item-message>
    <app-item-message
      *ngIf="mensaje.type!=='voice'"
      [message]="mensaje"
      [userName]="userName"
      [last]="isLast"
      [content]="content"
    ></app-item-message>
  </span>

</div>

<ion-footer>
  <form [formGroup]="miFormulario" style="display: contents;">
    <ion-toolbar class="loc_toolbar d-flex">
      <div
        class="loc__info-grabar"
        *ngIf="tooglePress===true"
      >
        <ion-icon name="radio-button-on-outline" class="loc__icon-grabando"></ion-icon>
        <p>{{tiempoGrabacion}}</p>

        <ion-icon name="chevron-back-outline"></ion-icon>
        <p>
          Deslice para cancelar
        </p>
      </div>
      <ion-icon
        [name]="showEmojiPicker?'keypad':'happy-sharp'"
        slot="start"
        color="secondary"
        class="loc_icon-footer"
        (click)="showEmojiPicker = !showEmojiPicker"
        *ngIf="tooglePress===false"
      ></ion-icon>

      <ion-textarea
        placeholder="Mensaje"
        class="chat__input"
        formControlName="mensaje"
        auto-grow="true"
        spellcheck="true"
        rows="1"
        *ngIf="tooglePress===false"
      ></ion-textarea>

      <ion-buttons
        slot="end"
        [class]="tooglePress?'footer-grabando loc__btns-footer':'loc__btns-footer'"
        *ngIf="miFormulario.invalid;else btnEnviar"
      >
         <app-file-selector
          *ngIf="tooglePress===false"
          [userName]="userName"
          [idChat]="idChat"
        ></app-file-selector>

          <ion-item-sliding (ionDrag)="handleSlide($event)" #sliding>
            <ion-item >
              <ion-label>
                <ion-button
                  slot="icon-only"
                  [class]="tooglePress?'loc__press':''"
                  (mousedown)="recorder()"
                  (mouseup)="stop()"
                  (touchend)="stop()"
                  (touchstart)="recorder()"
                >
                  <ion-icon
                    name="mic-sharp"
                    color="secondary"
                    class="loc_icon-footer"
                  ></ion-icon>
                </ion-button>
              </ion-label>
            </ion-item>

            <ion-item-options side="end">
              <ion-item-option expandable [class]="tooglePress?'grabando':''">

              </ion-item-option>
            </ion-item-options>
          </ion-item-sliding>
        </ion-buttons>

        <ng-template #btnEnviar>
          <ion-buttons slot="end" class="loc__btns-footer">
            <ion-icon
              name="send"
              color="secondary"
              class="loc_icon-footer"
              (click)="agregarMensaje()"
            ></ion-icon>
          </ion-buttons>
        </ng-template>

    </ion-toolbar>
  </form>
</ion-footer>

<ion-footer class="emojiContainer" [style.height]="showEmojiPicker?'300px':'0px'"> <!--Show/Hide emoji picker. Don't use *ngIf because the component will be created again and again and cause performance issue-->
  <!-- <emoji-picker (onEmojiSelect)="addEmoji($event)"></emoji-picker> -->
</ion-footer>
